(function(e){function t(t){return"".trim?t.val().trim():e.trim(t.val())}e.fn.isHappy=function(n){function s(e){return!!(e&&e.constructor&&e.call&&e.apply)}function o(t){return e('<span id="'+t.id+'" class="unhappyMessage" role="alert">'+t.message+"</span>")}function u(e){return s(n.errorTemplate)?n.errorTemplate(e):o(e)}function a(){var e=!1,t,i;for(t=0,i=r.length;t<i;t+=1)r[t].testValid(!0)||(e=!0);if(e)return s(n.unHappy)&&n.unHappy(),!1;if(n.testMode)return s(n.happy)&&n.happy(),window.console&&console.warn("would have submitted"),!1;s(n.happy)&&n.happy()}function f(i,o){var a=e(o),f={message:i.message||"",id:o.slice(1)+"_unhappy"},l=e(f.id).length>0?e(f.id):u(f);r.push(a),a.testValid=function(n){var r,o=e(this),u,f=!1,c,h=!!o.get(0).attributes.getNamedItem("required")||i.required,p=a.attr("type")==="password",d=s(i.arg)?i.arg():i.arg;return s(i.clean)?r=i.clean(o.val()):!i.trim&&!p?r=t(o):r=o.val(),o.val(r),u=(r.length>0||h==="sometimes")&&s(i.test),n===!0&&h===!0&&r.length===0?f=!0:u&&(f=!i.test(r,d)),f?(o.addClass("unhappy").after(l),!1):(c=l.get(0),c.parentNode&&c.parentNode.removeChild(c),o.removeClass("unhappy"),!0)},a.bind(n.when||"blur",a.testValid)}var r=[],i;for(i in n.fields)f(n.fields[i],i);return n.submitButton?e(n.submitButton).click(a):this.bind("submit",a),this}})(this.jQuery||this.Zepto);